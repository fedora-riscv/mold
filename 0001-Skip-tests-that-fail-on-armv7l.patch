From b0b069ece8d76914670bfdfd04ea628477c95988 Mon Sep 17 00:00:00 2001
Message-Id: <b0b069ece8d76914670bfdfd04ea628477c95988.1659770551.git.github@sicherha.de>
From: Christoph Erhardt <github@sicherha.de>
Date: Fri, 29 Apr 2022 21:44:33 +0200
Subject: [PATCH 1/2] Skip tests that fail on armv7l

---
 test/elf/exception.sh                 | 2 ++
 test/elf/gdb-index-compress-output.sh | 1 +
 test/elf/gdb-index-dwarf2.sh          | 1 +
 test/elf/gdb-index-dwarf3.sh          | 1 +
 test/elf/gdb-index-dwarf4.sh          | 1 +
 test/elf/gdb-index-dwarf5.sh          | 1 +
 test/elf/hello-static.sh              | 2 ++
 test/elf/ifunc-static.sh              | 2 ++
 8 files changed, 11 insertions(+)

diff --git a/test/elf/exception.sh b/test/elf/exception.sh
index 2a68a261..f406e2e2 100755
--- a/test/elf/exception.sh
+++ b/test/elf/exception.sh
@@ -12,6 +12,8 @@ echo -n "Testing $testname ... "
 t=out/test/elf/$MACHINE/$testname
 mkdir -p $t
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
+
 cat <<EOF | $CXX -c -o $t/a.o -xc++ -fPIC -
 int main() {
   try {
diff --git a/test/elf/gdb-index-compress-output.sh b/test/elf/gdb-index-compress-output.sh
index 83cd2cea..015fe874 100755
--- a/test/elf/gdb-index-compress-output.sh
+++ b/test/elf/gdb-index-compress-output.sh
@@ -14,6 +14,7 @@ mkdir -p $t
 
 [ $MACHINE = $(uname -m) ] || { echo skipped; exit; }
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
 [ $MACHINE = riscv64 ] && { echo skipped; exit; }
 
 which gdb >& /dev/null || { echo skipped; exit; }
diff --git a/test/elf/gdb-index-dwarf2.sh b/test/elf/gdb-index-dwarf2.sh
index 853f5ed8..dce14849 100755
--- a/test/elf/gdb-index-dwarf2.sh
+++ b/test/elf/gdb-index-dwarf2.sh
@@ -14,6 +14,7 @@ mkdir -p $t
 
 [ $MACHINE = $(uname -m) ] || { echo skipped; exit; }
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
 [ $MACHINE = riscv64 ] && { echo skipped; exit; }
 
 which gdb >& /dev/null || { echo skipped; exit; }
diff --git a/test/elf/gdb-index-dwarf3.sh b/test/elf/gdb-index-dwarf3.sh
index d2ce0804..0ced3284 100755
--- a/test/elf/gdb-index-dwarf3.sh
+++ b/test/elf/gdb-index-dwarf3.sh
@@ -14,6 +14,7 @@ mkdir -p $t
 
 [ $MACHINE = $(uname -m) ] || { echo skipped; exit; }
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
 [ $MACHINE = riscv64 ] && { echo skipped; exit; }
 
 which gdb >& /dev/null || { echo skipped; exit; }
diff --git a/test/elf/gdb-index-dwarf4.sh b/test/elf/gdb-index-dwarf4.sh
index ca81cf13..6be62e17 100755
--- a/test/elf/gdb-index-dwarf4.sh
+++ b/test/elf/gdb-index-dwarf4.sh
@@ -14,6 +14,7 @@ mkdir -p $t
 
 [ $MACHINE = $(uname -m) ] || { echo skipped; exit; }
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
 [ $MACHINE = riscv64 ] && { echo skipped; exit; }
 
 which gdb >& /dev/null || { echo skipped; exit; }
diff --git a/test/elf/gdb-index-dwarf5.sh b/test/elf/gdb-index-dwarf5.sh
index 8d5584e6..e4b30b94 100755
--- a/test/elf/gdb-index-dwarf5.sh
+++ b/test/elf/gdb-index-dwarf5.sh
@@ -14,6 +14,7 @@ mkdir -p $t
 
 [ $MACHINE = $(uname -m) ] || { echo skipped; exit; }
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
 [ $MACHINE = riscv64 ] && { echo skipped; exit; }
 
 which gdb >& /dev/null || { echo skipped; exit; }
diff --git a/test/elf/hello-static.sh b/test/elf/hello-static.sh
index a2c9626b..eed8b935 100755
--- a/test/elf/hello-static.sh
+++ b/test/elf/hello-static.sh
@@ -12,6 +12,8 @@ echo -n "Testing $testname ... "
 t=out/test/elf/$MACHINE/$testname
 mkdir -p $t
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
+
 cat <<EOF | $CC -o $t/a.o -c -xc -
 #include <stdio.h>
 
diff --git a/test/elf/ifunc-static.sh b/test/elf/ifunc-static.sh
index 8a25fa1c..b0cf698e 100755
--- a/test/elf/ifunc-static.sh
+++ b/test/elf/ifunc-static.sh
@@ -15,6 +15,8 @@ mkdir -p $t
 # IFUNC is not supported on RISC-V yet
 [ $MACHINE = riscv64 ] && { echo skipped; exit; }
 
+[ $MACHINE = armv7l ] && { echo skipped; exit; }
+
 # Skip if libc is musl because musl does not support GNU FUNC
 ldd --help 2>&1 | grep -q musl && { echo skipped; exit; }
 
-- 
2.37.1

